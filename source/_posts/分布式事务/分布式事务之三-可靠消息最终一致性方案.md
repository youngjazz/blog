---
title: 可靠消息最终一致性方案
date: 2018-11-07 21:35:36
tags: 分布式事务
categories: 技术
---



设计分析维度：

- 消息发送一致性的正向流程
- 消息发送一致性的异常处理流程
- 消息投递的正向流程
- 消息投递的异常处理流程

### 1.本地消息服务

![](https://ws4.sinaimg.cn/large/006tNbRwgy1fxi1ryjn70j30yn0u00vr.jpg)



- 优点：
    - 消息时效性高
    - 从应用设计开发的角度实现了消息数据的可靠性，消息数据的可靠性不依赖MQ中间件，弱化了对MQ中间件特性的依赖
    - 方案轻量， 容易实现

- 缺点
    - 与具体业务场景绑定，耦合性强，不可共用
    - 消息数据与业务数据同库，占用业务系统资源
    - 业务系统在使用关系型数据库的情况下，消息服务的性能会收到关系型数据库并发性能的局限。

### 2.独立消息服务

![](https://ws2.sinaimg.cn/large/006tNbRwgy1fxi45wk7w3j30wv0u0ag7.jpg)



## 设计实现

需要完成：

1.消息服务子系统

2.消息管理子系统（增加）

3.消息状态确认子系统

4.消息恢复子系统

5.实时消息服务